{"version":3,"sources":["StatusGif/StatusGif.js","index.js"],"names":["StatusGif","_ref","src","placeholderSrc","size","_useState","useState","_useState2","Object","slicedToArray","loaded","setLoaded","className","concat","react_default","a","createElement","onLoad","today","Date","todayString","getDate","getMonth","getFullYear","HOUR_THRESHOLD_MIN","HOUR_THRESHOLD_MAX","_callee","reservationResponse","regenerator_default","wrap","_context","prev","next","formData","FormData","append","fetch","method","body","then","response","json","sent","abrupt","html","html_search","doc","DOMParser","parseFromString","Array","from","querySelectorAll","filter","node","href","indexOf","map","innerHTML","reservation","hour","Number","slice","stop","RESERVATIONS_SECOND_ROW_THRESHOLD","RESERVATIONS_THIRD_ROW_THRESHOLD","imageSizeClassNameToFit","reservationTimesCount","rootElement","document","getElementById","ReactDOM","render","reservationTimes","setReservationTimes","_useState3","_useState4","hasReservations","setHasReservations","_useState5","_useState6","statusGifSrc","setStatusGifSrc","_useState7","_useState8","statusGifPlaceholderSrc","setStatusGifPlaceholderSrc","_useState9","_useState10","error","useEffect","fetchAndSetReservationHtml","length","tag","jsonResponse","gifUrl","data","images","downsized_large","url","gifUrlPaceholder","fixed_width_small_still","console","log","catch","err","Boolean","reservationTime","key"],"mappings":"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","file":"static/js/main.119cde9c.chunk.js","sourcesContent":["import React, { useState } from \"react\";\nimport \"./styles.css\";\nimport \"../styles/fadeIn.css\";\nimport \"../styles/fadeOut.css\";\n\nexport default function StatusGif({ src, placeholderSrc, size }) {\n  const [loaded, setLoaded] = useState(false);\n\n  const className = `${size ? \" status-image__size-\" + size : \"\"}`;\n\n  return (\n    <div className=\"status-image__wrapper\">\n      <img\n        src={placeholderSrc}\n        className={`status-image__placeholder ${className}${loaded &&\n          \" hidden fade-out\"}`}\n      />\n      <img\n        src={src}\n        className={`status-image ${className} fade-in`}\n        onLoad={() => {\n          setLoaded(true);\n        }}\n      />\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport StatusGif from \"./StatusGif/StatusGif\";\n\nimport \"./styles.css\";\nimport \"./styles/fadeIn.css\";\n\nconst today = new Date();\nconst todayString = `${today.getDate()}-${today.getMonth() +\n  1}-${today.getFullYear()}`;\n\nconst HOUR_THRESHOLD_MIN = 13;\nconst HOUR_THRESHOLD_MAX = 14;\nfunction parseReservationTimesFromHtml(html) {\n  var parser = new DOMParser();\n  var doc = parser.parseFromString(html, \"text/html\");\n\n  return Array.from(doc.querySelectorAll(\"a.btn.btn-default.bottomsearch\"))\n    .filter(node => {\n      return node.href.indexOf(\"cansegalar\") > -1;\n    })\n    .map(node => {\n      return node.innerHTML;\n    })\n    .filter(reservation => {\n      const hour = Number(reservation.slice(0, 2));\n      return hour >= HOUR_THRESHOLD_MIN && hour <= HOUR_THRESHOLD_MAX;\n    });\n}\n\nfunction fetchReservationHtml() {\n  const formData = new FormData();\n\n  formData.append(\"language\", \"spanish\");\n  formData.append(\"restaurant\", \"goiko-cansegalar\");\n  formData.append(\"hour\", \"13:00\");\n  formData.append(\"date\", todayString);\n  formData.append(\"people\", \"8\");\n\n  return fetch(\n    \"https://www.covermanager.com/reservation/search_restaurant_groups_nobottom\",\n    {\n      method: \"POST\",\n      body: formData // body data type must match \"Content-Type\" header\n    }\n  ).then(response => response.json());\n}\n\nasync function fetchAndSetReservationHtml() {\n  const reservationResponse = await fetchReservationHtml();\n  return parseReservationTimesFromHtml(reservationResponse.html_search);\n}\n\nfunction fetchGif(tag) {\n  return fetch(\n    `https://api.giphy.com/v1/gifs/random?api_key=RZAnLTeX9PwNoAMEy9nIl79GfxD4FhJi&tag=${tag}`\n  )\n    .then(response => response.json())\n    .then(jsonResponse => {\n      const gifUrl = jsonResponse.data.images.downsized_large.url;\n      const gifUrlPaceholder =\n        jsonResponse.data.images.fixed_width_small_still.url;\n      console.log(gifUrl);\n      return { gifUrl, gifUrlPaceholder };\n    });\n}\n\nconst RESERVATIONS_SECOND_ROW_THRESHOLD = 9;\nconst RESERVATIONS_THIRD_ROW_THRESHOLD = 13;\nfunction imageSizeClassNameToFit(reservationTimesCount) {\n  if (reservationTimesCount === 0) {\n    return;\n  }\n\n  if (reservationTimesCount < RESERVATIONS_SECOND_ROW_THRESHOLD) {\n    return \"medium\";\n  }\n\n  if (reservationTimesCount < RESERVATIONS_THIRD_ROW_THRESHOLD) {\n    return \"small\";\n  }\n\n  return;\n}\n\nfunction App() {\n  const [reservationTimes, setReservationTimes] = useState(null);\n  const [hasReservations, setHasReservations] = useState(null);\n  const [statusGifSrc, setStatusGifSrc] = useState(null);\n  const [statusGifPlaceholderSrc, setStatusGifPlaceholderSrc] = useState(null);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    fetchAndSetReservationHtml().then(reservationTimes => {\n      setReservationTimes(reservationTimes);\n      setHasReservations(reservationTimes.length > 0);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (hasReservations == null) {\n      return;\n    }\n\n    const imageTag = hasReservations ? \"eat\" : \"sad\";\n\n    fetchGif(imageTag)\n      .then(\n        ({\n          gifUrl: statusGifSrc,\n          gifUrlPaceholder: statusGifPlaceholderSrc\n        }) => {\n          setStatusGifSrc(statusGifSrc);\n          setStatusGifPlaceholderSrc(statusGifPlaceholderSrc);\n        }\n      )\n      .catch(err => {\n        setStatusGifSrc(hasReservations ? \"img/eat.gif\" : \"img/sad.gif\");\n      });\n  }, [hasReservations]);\n\n  if (error) {\n    return <h1>ERROR</h1>;\n  }\n\n  return (\n    <div className=\"App\">\n      <h1>goiko checker üçî</h1>\n      {Boolean(hasReservations != null) && (\n        <section>\n          <StatusGif\n            src={statusGifSrc}\n            placeholderSrc={statusGifPlaceholderSrc}\n            size={imageSizeClassNameToFit(reservationTimes.length)}\n          />\n        </section>\n      )}\n      {Boolean(hasReservations) && (\n        <section className=\"reservation-time__list fade-in\">\n          {reservationTimes.map(reservationTime => (\n            <article className=\"reservation-time__item\" key={reservationTime}>\n              {reservationTime}\n            </article>\n          ))}\n        </section>\n      )}\n      {Boolean(hasReservations === false) && (\n        <section className=\"no-reservations fade-in\">\n          Hoy te toca <span>SaladMarket ü•ó</span>\n        </section>\n      )}\n    </div>\n  );\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}